---
title: "Reproducible Research Project 1"
author: "Nathan E. Wendling"
date: "November 15, 2015"
output: html_document
---

##Initalization##
Initially load libraries and data
```{r loadinfo, echo=TRUE, results='hide'}
options(digits=8)
library(graphics)
activity <- read.csv("activity.csv", header=TRUE, sep=",", quote="\"", na.strings="NA", stringsAsFactors=FALSE)
tmptime <- activity$interval
tmptime <- paste(floor(tmptime/60), ifelse(tmptime-60*floor(tmptime/60)<10, paste("0",tmptime-60*floor(tmptime/60), sep=""), tmptime-60*floor(tmptime/60)), sep=":") #hh:mm, with 0 padding on minutes
timeToAct <- data.frame(strptime(paste(activity$date, tmptime, sep=" "), format="%Y-%m-%d %H:%M"), activity$steps)
colnames(timeToAct) <- c("Date", "Steps") #human understandable
timeToAct$Date <- as.POSIXlt(timeToAct$Date) #easier to divide up by day
dateToAct <- data.frame(activity$date, tmptime, activity$steps) #easier to divide up by interval
colnames(dateToAct) <- c("Date", "Time", "Steps")
```

##Daily##
Now to get the number of steps per day:
```{r summary}
daytotals <-tapply(timeToAct$Steps, INDEX=timeToAct$Date$yday, FUN=sum)
daytotmean <- mean(daytotals, na.rm=TRUE)
daytotmed <- median(daytotals, na.rm=TRUE)
hist(daytotals, xlab="Daily Number of steps", col="wheat", main="Total Steps per Day", breaks=20)
```

The median is `r daytotmed` and the mean is `r daytotmean`.

##Interval##
Now to cut by 5 minute interval (ignoring NA values)
```{r timing}
stepsAtTime<-tapply(dateToAct$Steps, INDEX=dateToAct$Time, FUN=mean, na.rm=TRUE)
maxsteps <- max(stepsAtTime)
indexOfMax <- which(stepsAtTime==max(stepsAtTime))
intervalMax <- 5*indexOfMax
formattedmax <- paste(floor(intervalMax/60), ifelse(intervalMax-60*floor(intervalMax/60)<10, paste("0",intervalMax-60*floor(intervalMax/60), sep=""), intervalMax-60*floor(intervalMax/60)), sep=":")
plot(stepsAtTime, type="l", xlab="5 minute Interval (288 in a day)", ylab="Steps", main="Steps in 5 minutes over all days")
```

The maximum was `r maxsteps` at `r formattedmax`.

##Dealing with missing values:##
In place of NA values, we substitute the mean of the interval in which the value occurs, as evaluated above in stepsAtTime.
```{r missing}
totna <- sum(is.na(timeToAct$Steps))
percenttot <- (sum(is.na(timeToAct$Steps))/length(timeToAct$Steps))*100

filledsteps <- dateToAct #broken up first
while(length(which(is.na(filledsteps$Steps)))>0) {   #fill in all na values
   i=which(is.na(filledsteps$Steps))[1] #take first element index
   hrmin<-strsplit(as.character(filledsteps[i,]$Time), split=":") #get the interval index for stepsAtTime
   intervali<- (as.numeric(hrmin[[1]][1])*60 + as.numeric(hrmin[[1]][2]))/5 +1  #0:00 is the first element
   if(intervali>288) {intervali<-1}    #some 24:00 in data as well as 0:00
   filledsteps[i,]$Steps <- stepsAtTime[intervali]
}
daysums <- tapply(filledsteps$Steps, INDEX=filledsteps$Date, FUN=sum)
daySumMean <- mean(daysums)
daySumMedian <- median(daysums)
hist(daysums, xlab="Steps per day", main="Total Steps per Day", col="blue", breaks=20)
```

The total number of missing values is `r totna`, that being `r percenttot`% of the data.  Once missing values are filled in with the mean of their timeslot, we get an average daily mean step count of `r daySumMean` and median of `r daySumMedian`.  This compares with the NA-containing data having median `r daytotmed` and the mean `r daytotmean`.


##Weekdays vs Weekends##
Using the weekdays() function to seperate weekdays from weekends, we then compare them.  In order to reduce the length of this report, much of the dataframes above will be used.
```{r weekdays}
weekdayq <- function(date){
   tmp <- weekdays(as.Date(as.character(date)))    #not so nice factor problems eliminated
   if(tmp=="Sunday" || tmp=="Saturday") {
      return(1)
   } else {
      return(0)
   }
}

weekdayData <- filledsteps    #as above
weekdayType <- tapply(weekdayData$Date,INDEX = 1:length(weekdayData$Steps), FUN=weekdayq)
weekday.factor<-factor(weekdayType, labels = c("Weekday", "Weekend"))
wdayWithFactor <- cbind(weekdayData, weekday.factor)
colnames(wdayWithFactor)[4] <- "Weekday"

```